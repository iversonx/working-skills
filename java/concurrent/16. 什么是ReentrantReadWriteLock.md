ReentrantReadWriteLock可重入读写锁，读写锁指在同一时刻可以允许多个读线程访问，但在写线程访问时，其他读线程和其他写线程将被阻塞。

ReentrantReadWriteLock的特性：

- 支持锁的公平性选择

- 支持重进入，即写线程在获取了写锁后，同一个线程能够再次获取写锁，也可以获取读锁；读线程获取读锁之后，能个再次获取读锁。

- 锁降级：锁降级就是当前线程拥有写锁，在不释放写锁时，去获取读锁，随后释放写锁的过程。

ReentrantReadWriteLock适用于读操作多于写操作的场景。

###### 读写状态的设计

在AQS中，采用一个int(int占32位)变量来维护同步状态；读写锁要在一个变量上维护两种状态，则将int变量拆分为两个部分，高16位表示读，低16位表示写，并通过位运算来确定读和写各自的状态。

例如当前同步状态值为S，那么写状态等于S & 0x0000FFFF，读状态等S >>>16。当写状态增加1时，等于S+1；当读状态加1时，等于S+(1<<16)

###### 写锁的获取与释放

写锁是一个支持重进入的排它锁。当线程在获取写锁时，如果读锁已被获取，或该线程不是已获取写锁的线程，则该线程进入等待队列；如果线程获取到写锁，则写状态增加。在获取写锁时，会判断是否存在读锁，其目的是确保写锁的操作对读锁是可见的。如果允许在已获取读锁的情况，获取写锁，那么正在运行的读线程无法感知到写线程的操作。

每次释放写锁，均会减少写状态，当写状态为0时，表示写锁已被释放，从而等待的线程能够继续访问读写锁。

###### 读锁的获取与释放

读锁是支持重入的共享锁，能够被多个线程同时获取。线程在获取读锁时，如果已经有其他线程获取了写锁，则该线程进入等待状态；否则获取读锁成功，读状态增加。

读锁每次释放时都或减少读状态。

###### 锁降级

锁降级指线程在拥有写锁时，再获取读锁，随后释放写锁的过程。在这个过程中，读锁的获取操作是为了保证数据的可见性。如果线程在持有写锁的时不获取读锁而直接释放写锁，此时有另一个线程获取了写锁并对数据进行了修改，当前线程是无法感知到另一个线程的数据更新。
